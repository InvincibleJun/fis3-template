## d1-web

### 部署相关

主要通过 jenkins 编译服务拉取代码，通过 fis3 编译前端代码，推送至目标生产图。

#### 非覆盖式静态资源发布

之前覆盖部署时，前端文件分为页面和静态文件，加以后缀，如 index.js?v=1。经典问题，先部署页面还是先部署资源？

1.先部署页面。在资源未部署时，客户端访问页面时，所有内嵌资源出现不存在或者脚本报错，资源依赖发生变化，而资源又未同步。

2.先部署资源。在页面未部署时，未缓存的客户端访问旧页面，而旧的资源有些已经被替换删除，同样发生页面混乱问题。

以上两种情况都将造成短时间的用户页面混乱问题，全量覆盖资源，未必是一种好的方案。

非覆盖发布，为每一个资源打上唯一资源符。先发布资源，同样文件不替换，不同文件增加，对于客户端是无痕操作的。之后部署页面，访问新资源。

#### nginx 相关

设置较大的 expires 和 cache-control，并对较大 js 文件做 gzip 处理，通常能压缩一半体积

#### egg 启动

通过内置的 egg-scripts 启动，注意其未常驻进程，重启时需要执行 npm run stop 之后执行 start 命令

#### fis3

npm run build 生产文件。分为 template/static。static 用于静态文件，template 为动态页面，作为后端模板拼接使用。
发布
